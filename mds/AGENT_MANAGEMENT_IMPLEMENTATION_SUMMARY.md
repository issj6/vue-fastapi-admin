# ä»£ç†ç®¡ç†æ¨¡å—å®ç°æ€»ç»“

## ğŸ¯ åŠŸèƒ½æ¦‚è¿°

æˆåŠŸå®ç°äº†ä»£ç†ç”¨æˆ·å’Œæ™®é€šç”¨æˆ·çš„åˆ†ç¦»ç®¡ç†ï¼Œåœ¨ç³»ç»Ÿç®¡ç†æ¨¡å—ä¸­æ–°å¢äº†"ä»£ç†ç®¡ç†"äºŒçº§èœå•ï¼Œå®ç°äº†åŸºäºç”¨æˆ·å±‚çº§çš„æ•°æ®è¿‡æ»¤å’Œæƒé™æ§åˆ¶ã€‚

## ğŸ—ï¸ å®ç°æ¶æ„

### 1. èœå•ç»“æ„
```
ç³»ç»Ÿç®¡ç†/
â”œâ”€â”€ ç”¨æˆ·ç®¡ç† (æ˜¾ç¤ºæ™®é€šç”¨æˆ·ï¼Œå±‚çº§99)
â”œâ”€â”€ ä»£ç†ç®¡ç† (æ˜¾ç¤ºä»£ç†ç”¨æˆ·ï¼Œå±‚çº§<99) âœ¨ æ–°å¢
â”œâ”€â”€ è§’è‰²ç®¡ç†
â”œâ”€â”€ èœå•ç®¡ç†
â””â”€â”€ APIç®¡ç†
```

### 2. æ•°æ®åˆ†ç¦»é€»è¾‘
- **ä»£ç†ç®¡ç†**ï¼šæ˜¾ç¤º `user_level < 99` ä¸” `user_level > å½“å‰ç”¨æˆ·å±‚çº§` çš„ç”¨æˆ·
- **ç”¨æˆ·ç®¡ç†**ï¼šæ˜¾ç¤º `user_level = 99` çš„æ™®é€šç”¨æˆ·
- **ç®¡ç†å‘˜ç‰¹æƒ**ï¼šå¯ä»¥æŸ¥çœ‹æ‰€æœ‰å±‚çº§çš„ç”¨æˆ·

## ğŸ”§ æŠ€æœ¯å®ç°

### 1. åç«¯APIå®ç°

#### æ–°å¢ä»£ç†ç”¨æˆ·åˆ—è¡¨æ¥å£
```python
@router.get("/agents", summary="æŸ¥çœ‹ä»£ç†ç”¨æˆ·åˆ—è¡¨")
async def list_agent_users(
    page: int = Query(1, description="é¡µç "),
    page_size: int = Query(10, description="æ¯é¡µæ•°é‡"),
    username: str = Query("", description="ç”¨æˆ·åç§°"),
    email: str = Query("", description="é‚®ç®±åœ°å€"),
):
    # æƒé™æ£€æŸ¥
    has_permission = await check_view_subordinate_users(current_user_id)
    
    # è¿‡æ»¤ä»£ç†ç”¨æˆ·ï¼ˆå±‚çº§ < 99ï¼‰
    # å±‚çº§æƒé™æ§åˆ¶ï¼ˆåªèƒ½æŸ¥çœ‹æ¯”è‡ªå·±å±‚çº§ä½çš„ç”¨æˆ·ï¼‰
```

#### ä¿®æ”¹ç”¨æˆ·ç®¡ç†æ¥å£
```python
@router.get("/list", summary="æŸ¥çœ‹æ™®é€šç”¨æˆ·åˆ—è¡¨")
async def list_user():
    # è¿‡æ»¤æ™®é€šç”¨æˆ·ï¼ˆå±‚çº§ = 99ï¼‰
    # æ’é™¤ä»£ç†ç”¨æˆ·
```

### 2. æƒé™æ˜ å°„é…ç½®

#### æ›´æ–°èœå•æƒé™æ˜ å°„
```python
PERMISSION_MENU_MAP = {
    AgentPermission.VIEW_SUBORDINATE_USERS.value: [
        "ç”¨æˆ·ç®¡ç†",  # æ™®é€šç”¨æˆ·åˆ—è¡¨é¡µé¢
        "ä»£ç†ç®¡ç†",  # ä»£ç†ç”¨æˆ·åˆ—è¡¨é¡µé¢ âœ¨ æ–°å¢
    ],
    AgentPermission.CREATE_SUBORDINATE_AGENT.value: [
        "ä»£ç†ç®¡ç†",  # âœ¨ æ–°å¢
    ],
    # ... å…¶ä»–æƒé™æ˜ å°„
}
```

#### æ–°å¢APIæƒé™æ˜ å°„
```python
PERMISSION_API_MAP = {
    AgentPermission.VIEW_SUBORDINATE_USERS.value: [
        ("GET", "/api/v1/user/list"),
        ("GET", "/api/v1/user/agents"),  # âœ¨ æ–°å¢
        # ... å…¶ä»–API
    ],
}
```

### 3. å‰ç«¯å®ç°

#### ä»£ç†ç®¡ç†é¡µé¢
- **è·¯å¾„**: `/system/agent`
- **ç»„ä»¶**: `web/src/views/system/agent/index.vue`
- **åŠŸèƒ½**: 
  - ä»£ç†ç”¨æˆ·åˆ—è¡¨å±•ç¤º
  - ä»£ç†ç”¨æˆ·åˆ›å»º/ç¼–è¾‘
  - ç§¯åˆ†ç®¡ç†
  - ä¸‹çº§ç”¨æˆ·æŸ¥çœ‹
  - æƒé™æ§åˆ¶

#### è·¯ç”±é…ç½®
```javascript
// web/src/views/system/agent/route.js
export default {
  name: 'ä»£ç†ç®¡ç†',
  path: '/system/agent',
  component: Layout,
  meta: {
    title: 'ä»£ç†ç®¡ç†',
    icon: 'carbon:user-multiple',
    order: 7,
  },
}
```

## ğŸ“Š æ•°æ®è¿‡æ»¤æ•ˆæœ

### æµ‹è¯•ç»“æœ
```
ğŸ“Š æ•°æ®åº“ç”¨æˆ·ç»Ÿè®¡:
   - æ€»ç”¨æˆ·æ•°: 42
   - ä»£ç†ç”¨æˆ·æ•°: 24 (å±‚çº§ < 99)
   - æ™®é€šç”¨æˆ·æ•°: 18 (å±‚çº§ = 99)

APIæ¥å£æµ‹è¯•:
   âœ… ä»£ç†ç”¨æˆ·åˆ—è¡¨æ¥å£: 24ä¸ªä»£ç†ç”¨æˆ·
   âœ… æ™®é€šç”¨æˆ·åˆ—è¡¨æ¥å£: 18ä¸ªæ™®é€šç”¨æˆ·
```

### æƒé™æ§åˆ¶éªŒè¯
- âœ… **ç®¡ç†å‘˜ç‰¹æƒ**ï¼šå¯ä»¥æŸ¥çœ‹æ‰€æœ‰ä»£ç†å’Œæ™®é€šç”¨æˆ·
- âœ… **å±‚çº§æ§åˆ¶**ï¼šä»£ç†åªèƒ½æŸ¥çœ‹æ¯”è‡ªå·±å±‚çº§ä½çš„ç”¨æˆ·
- âœ… **æ•°æ®åˆ†ç¦»**ï¼šä»£ç†ç®¡ç†å’Œç”¨æˆ·ç®¡ç†æ˜¾ç¤ºä¸åŒçš„ç”¨æˆ·ç¾¤ä½“
- âœ… **æƒé™æ˜ å°„**ï¼šåŸºäºä»£ç†æƒé™æ§åˆ¶èœå•å¯è§æ€§

## ğŸ¯ ç”¨æˆ·ä½“éªŒ

### èœå•å¯¼èˆª
```
ç³»ç»Ÿç®¡ç†
â”œâ”€â”€ ç”¨æˆ·ç®¡ç† â†’ æ™®é€šç”¨æˆ·ï¼ˆå­¦ç”Ÿã€å®¢æˆ·ç­‰ï¼‰
â””â”€â”€ ä»£ç†ç®¡ç† â†’ ä»£ç†ç”¨æˆ·ï¼ˆå„çº§ä»£ç†å•†ï¼‰
```

### åŠŸèƒ½ç‰¹æ€§
1. **æ¸…æ™°åˆ†ç¦»**ï¼šä»£ç†å’Œæ™®é€šç”¨æˆ·åˆ†å¼€ç®¡ç†ï¼Œé¿å…æ··æ·†
2. **æƒé™æ§åˆ¶**ï¼šåŸºäºç”¨æˆ·å±‚çº§çš„ç²¾ç¡®æƒé™æ§åˆ¶
3. **ç»Ÿä¸€ç•Œé¢**ï¼šä¸¤ä¸ªé¡µé¢ä½¿ç”¨ç›¸åŒçš„UIç»„ä»¶ï¼Œä¿æŒä¸€è‡´æ€§
4. **å®Œæ•´åŠŸèƒ½**ï¼šæ”¯æŒåˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤ã€ç§¯åˆ†ç®¡ç†ç­‰å…¨éƒ¨åŠŸèƒ½

## ğŸ”’ å®‰å…¨ä¿éšœ

### æƒé™éªŒè¯
1. **APIå±‚é¢**ï¼šæ¯ä¸ªæ¥å£éƒ½æœ‰æƒé™æ£€æŸ¥
2. **æ•°æ®å±‚é¢**ï¼šåŸºäºç”¨æˆ·å±‚çº§è¿‡æ»¤æ•°æ®
3. **èœå•å±‚é¢**ï¼šæ ¹æ®æƒé™æ§åˆ¶èœå•å¯è§æ€§
4. **æ“ä½œå±‚é¢**ï¼šåªèƒ½æ“ä½œæœ‰æƒé™çš„ç”¨æˆ·

### å±‚çº§æ§åˆ¶
- **è¶…çº§ç®¡ç†å‘˜**ï¼šå¯ä»¥ç®¡ç†æ‰€æœ‰ç”¨æˆ·
- **ä¸€çº§ä»£ç†**ï¼šå¯ä»¥ç®¡ç†äºŒçº§ä»£ç†å’Œæ™®é€šç”¨æˆ·
- **äºŒçº§ä»£ç†**ï¼šåªèƒ½ç®¡ç†æ™®é€šç”¨æˆ·
- **æ™®é€šç”¨æˆ·**ï¼šåªèƒ½æŸ¥çœ‹è‡ªå·±çš„ä¿¡æ¯

## ğŸš€ éƒ¨ç½²è¯´æ˜

### æ•°æ®åº“å˜æ›´
- âœ… æ— éœ€æ•°æ®åº“ç»“æ„å˜æ›´
- âœ… åˆ©ç”¨ç°æœ‰çš„è§’è‰²å±‚çº§ç³»ç»Ÿ
- âœ… æ–°å¢èœå•é¡¹å·²è‡ªåŠ¨åˆ›å»º

### å‰ç«¯éƒ¨ç½²
- âœ… æ–°å¢ä»£ç†ç®¡ç†é¡µé¢ç»„ä»¶
- âœ… è·¯ç”±é…ç½®å·²å®Œæˆ
- âœ… APIæ¥å£å·²é›†æˆ

### åç«¯éƒ¨ç½²
- âœ… æ–°å¢ä»£ç†ç”¨æˆ·åˆ—è¡¨API
- âœ… ä¿®æ”¹ç”¨æˆ·åˆ—è¡¨è¿‡æ»¤é€»è¾‘
- âœ… æƒé™æ˜ å°„é…ç½®å·²æ›´æ–°

## ğŸ“ ä½¿ç”¨æŒ‡å—

### ç®¡ç†å‘˜æ“ä½œ
1. ç™»å½•ç³»ç»Ÿåï¼Œåœ¨"ç³»ç»Ÿç®¡ç†"èœå•ä¸‹å¯çœ‹åˆ°ï¼š
   - **ç”¨æˆ·ç®¡ç†**ï¼šç®¡ç†æ™®é€šç”¨æˆ·ï¼ˆå­¦ç”Ÿã€å®¢æˆ·ç­‰ï¼‰
   - **ä»£ç†ç®¡ç†**ï¼šç®¡ç†ä»£ç†ç”¨æˆ·ï¼ˆå„çº§ä»£ç†å•†ï¼‰

2. ä¸¤ä¸ªæ¨¡å—åŠŸèƒ½ç›¸åŒï¼Œä½†æ˜¾ç¤ºçš„ç”¨æˆ·ç¾¤ä½“ä¸åŒ

### ä»£ç†æ“ä½œ
1. æ ¹æ®æƒé™ç­‰çº§ï¼Œåªèƒ½çœ‹åˆ°å¯¹åº”çš„èœå•
2. åªèƒ½æŸ¥çœ‹å’Œç®¡ç†æ¯”è‡ªå·±å±‚çº§ä½çš„ç”¨æˆ·
3. æ•°æ®è‡ªåŠ¨æŒ‰å±‚çº§è¿‡æ»¤ï¼Œç¡®ä¿æƒé™å®‰å…¨

## âœ… å®ç°å®Œæˆåº¦

- [x] åˆ›å»ºä»£ç†ç®¡ç†èœå•
- [x] å®ç°åç«¯ä»£ç†ç®¡ç†API
- [x] æ›´æ–°æƒé™æ˜ å°„é…ç½®
- [x] ä¿®æ”¹ç”¨æˆ·ç®¡ç†APIè¿‡æ»¤é€»è¾‘
- [x] åˆ›å»ºå‰ç«¯ä»£ç†ç®¡ç†é¡µé¢
- [x] é…ç½®å‰ç«¯è·¯ç”±
- [x] æµ‹è¯•åŠŸèƒ½å®Œæ•´æ€§

**ğŸ‰ ä»£ç†ç®¡ç†æ¨¡å—å®ç°å®Œæˆï¼ç”¨æˆ·å’Œä»£ç†çš„åˆ†ç¦»ç®¡ç†å·²æˆåŠŸä¸Šçº¿ï¼**
